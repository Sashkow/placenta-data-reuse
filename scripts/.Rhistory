N.data@assayData$exprs <- combat_edata
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_Condition",
force = TRUE,
intgroup = c("Condition"))
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_Sentrix_ID",
force = TRUE,
intgroup = c("Sentrix_ID"))
N.data <- N.data[, c(-23, -24)]
pca = prcomp(t(exprs(N.data)))
title <- ggdraw() + draw_label(studies[i,]$ID, fontface='bold')
pl <- autoplot(pca, data = pData(N.data), colour="Condition")
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
pl)
colnames(N.data)
View(pdata)
N.data <- N.data[, c(-7, -16)]
pca = prcomp(t(exprs(N.data)))
title <- ggdraw() + draw_label(studies[i,]$ID, fontface='bold')
pl <- autoplot(pca, data = pData(N.data), colour="Condition")
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
pl)
i=1
dir = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
View(pdata)
idatfiles = dir(dir, pattern="idat", full.name=TRUE)
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
batch = pData(N.data)$Sentrix_ID
mod = model.matrix(~as.factor(Condition), data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
N.data <- N.data[, c(-7, -16)]
pca = prcomp(t(exprs(N.data)))
title <- ggdraw() + draw_label(studies[i,]$ID, fontface='bold')
pl <- autoplot(pca, data = pData(N.data), colour="Condition")
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
pl)
N.data <- N.data[, c(-21, -22)]
pca = prcomp(t(exprs(N.data)))
title <- ggdraw() + draw_label(studies[i,]$ID, fontface='bold')
pl <- autoplot(pca, data = pData(N.data), colour="Condition")
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
pl)
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_",
force = TRUE,
intgroup = c("Condition"))
pca = prcomp(t(exprs(N.data)))
title <- ggdraw() + draw_label(studies[i,]$ID, fontface='bold')
pl <- autoplot(pca, data = pData(N.data), colour="Sentrix_ID")
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
# Save plot for manual quality control
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
pl)
i=1
dir = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
idatfiles = dir(dir, pattern="idat", full.name=TRUE)
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
# Batch-effect removal
batch = pData(N.data)$Sentrix_ID
mod = model.matrix(~as.factor(Condition), data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
i=1
dir = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
idatfiles = dir(dir, pattern="idat", full.name=TRUE)
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
N.data <- N.data[, c(-23, -24)]
N.data <- N.data[, c(-7, -16)]
pca = prcomp(t(exprs(N.data)))
title <- ggdraw() + draw_label(studies[i,]$ID, fontface='bold')
pl <- autoplot(pca, data = pData(N.data), colour="Sentrix_ID")
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
# Save plot for manual quality control
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
pl)
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_",
force = TRUE,
intgroup = c("Condition"))
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.svg", sep=""),
pl)
pl
title <- ggdraw() + draw_label(studies[i,]$ID, fontface='bold')
pl <- autoplot(pca, data = pData(N.data), colour="Condition")
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
pl
install.packages("gridSVG")
idatfiles
View(pdata)
pdata$Comment=="Suspicious"
path = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
idatfiles = dir(path, pattern="idat", full.name=TRUE)
pdata$Comment=="Suspicious"
which(pdata$Comment=="Suspicious")
susp = which(pdata$Comment=="Suspicious")
idatfiles
idatfiles <- idatfiles[-susp]
pdata
b <_ c(2, 3)
b <- c(2, 3)
length(b)
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
source("pcaPlots.R")
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
pl
title <- ggdraw() + draw_label(title, fontface='bold')
plots <- c()
source("pcaPlots.R")
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
function (plot)
title <- ggdraw() + draw_label(title, fontface='bold')
plots <- c()
for (i in meta.vars) {
pl <- autoplot(pca.data, data = pheno.data, colour=i)
plots <- c(plots, pl)
}
meta.vars = c("Condition", "Sentrix_ID")
title <- ggdraw() + draw_label(title, fontface='bold')
plots <- c()
for (i in meta.vars) {
pl <- autoplot(pca.data, data = pheno.data, colour=i)
plots <- c(plots, pl)
}
pca.data = pca
for (i in meta.vars) {
pl <- autoplot(pca.data, data = pheno.data, colour=i)
plots <- c(plots, pl)
}
pheno.data = pData(N.data)
title <- ggdraw() + draw_label(title, fontface='bold')
plots <- c()
for (i in meta.vars) {
pl <- autoplot(pca.data, data = pheno.data, colour=i)
plots <- c(plots, pl)
}
pl <- plot_grid(plots, ncol=length(b))
pl <- plot_grid(list(plots), ncol=length(b))
pl <- plot_grid(unlist(plots), ncol=length(b))
pl <- plot_grid(plotlist = plots, ncol=length(b))
plots
plots <- c()
for (i in meta.vars) {
pl <- autoplot(pca.data, data = pheno.data, colour=i)
plots <- c(plots, c(pl))
}
pl <- plot_grid(plotlist = plots, ncol=length(b))
plots <- c()
for (i in meta.vars) {
pl <- autoplot(pca.data, data = pheno.data, colour=i)
plots <- c(plots, list(pl))
}
pl <- plot_grid(plotlist = plots, ncol=length(b))
pl
plots <- c()
for (i in meta.vars) {
pl <- autoplot(pca.data, data = as.character(pheno.data), colour=i)
plots <- c(plots, list(pl))
}
pheno.data
pheno.data[] <- lapply(pheno.data, as.character)
View(pheno.data)
plots <- c()
for (i in meta.vars) {
pl <- autoplot(pca.data, data = pheno.data, colour=i)
plots <- c(plots, list(pl))
}
pl <- plot_grid(plotlist = plots, ncol=length(b))
ะทะด
pl
pl <- plot_grid(title, pl, ncol=1, rel_heights=c(0.1, 1))
pl
source("pcaPlots.R")
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
pl
pl
studies[i,]$ID
i=1
i=1
studies[i,]$ID
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
pl
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_aspect_ratio = 2, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_aspect_ratio = 4, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_aspect_ratio = 2.5, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_aspect_ratio = 2.2, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_aspect_ratio = 2.5, pl)
pl
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=5, base_aspect_ratio = 1, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=15, base_aspect_ratio = 1, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=8, base_aspect_ratio = 1, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=10, base_aspect_ratio = 1, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=10, base_aspect_ratio = 0.7, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=10, base_aspect_ratio = 0.4, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=10, base_aspect_ratio = 1.4, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_width=10, base_aspect_ratio = 2.4, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_heigth=10, base_aspect_ratio = 2.4, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=10, base_aspect_ratio = 2.4, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=5, base_aspect_ratio = 2.4, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=5, base_aspect_ratio = 1, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=5, base_aspect_ratio = 2, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2, pl)
studies <- read.table("../pdata/studies.tsv", header = TRUE, sep = "\t")
# London
i=1
path = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
idatfiles = dir(path, pattern="idat", full.name=TRUE)
susp = which(pdata$Comment=="Suspicious")
idatfiles <- idatfiles[-susp]
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
studies <- read.table("../pdata/studies.tsv", header = TRUE, sep = "\t")
i=1
path = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
idatfiles = dir(path, pattern="idat", full.name=TRUE)
susp = which(pdata$Comment=="Suspicious")
idatfiles <- idatfiles[-susp]
pdata <- pdata[-susp,]
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2, pl)
pdata <- pdata[c(-20, -21),]
idatfiles <- idatfiles[c(-20, -21)]
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
# Save plot for manual quality control
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.5, pl)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
batch = pData(N.data)$Sentrix_ID
mod = model.matrix(~as.factor(Condition), data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
library(sva)
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
View(mod)
pData(N.data)
~as.factor(Condition)
batch = pData(N.data)$Sentrix_ID
barch
batch
batch = pData(N.data)$Sentrix_ID
mod = model.matrix(~1, data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
batch = pData(N.data)$Sentrix_ID
mod = model.matrix(~Condition, data=pData(N.data))
View(mod)
pData(N.data)
studies <- read.table("../pdata/studies.tsv", header = TRUE, sep = "\t")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
i=1
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
susp = which(pdata$Comment=="Suspicious")
pdata <- pdata[-susp,]
pdata <- pdata[c(-20, -21),]
View(pdata)
pdata
mod = model.matrix(~Condition, data=pdata)
View(mod)
View(pdata)
View(mod)
studies <- read.table("../pdata/studies.tsv", header = TRUE, sep = "\t")
i=1
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
mod = model.matrix(~Condition, data=pdata)
View(mod)
View(pdata)
View(pdata)
mod = model.matrix(~as.factor(Condition), data=pdata)
View(mod)
View(pdata)
as.factor(pheno$Condition)
as.factor(pdata$Condition)
mod = model.matrix(~Condition, data=pdata)
mod
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE)
mod = model.matrix(~Condition, data=pdata)
mod
susp = which(pdata$Comment=="Suspicious")
pdata <- pdata[-susp,]
pdata <- pdata[c(-20, -21),]
pdata
mod = model.matrix(~Condition, data=pdata)
View(mod)
mod = model.matrix(~pdata$Condition, data=pdata)
View(mod)
mm <- pdata
mod = model.matrix(~Condition, data=mm)
ls
ls.str()
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE, stringsAsFactors = FALSE)
ls.str()
studies <- read.table("../pdata/studies.tsv", header = TRUE, sep = "\t")
i=1
path = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE, stringsAsFactors = FALSE)
idatfiles = dir(path, pattern="idat", full.name=TRUE)
susp = which(pdata$Comment=="Suspicious")
pdata <- pdata[-susp,]
idatfiles <- idatfiles[-susp]
pdata <- pdata[c(-20, -21),]
idatfiles <- idatfiles[c(-20, -21)]
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
batch = pData(N.data)$Sentrix_ID
batch = as.factor(pData(N.data)$Sentrix_ID)
mod = model.matrix(~as.factor(Condition), data=mm)
mod = model.matrix(~as.factor(Condition), data=)
mod = model.matrix(~as.factor(Condition), data=pData(N.data))
View(mod)
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
source("pcaPlots.R")
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
source("pcaPlots.R")
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
i=1
path = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE, stringsAsFactors = FALSE)
idatfiles = dir(path, pattern="idat", full.name=TRUE)
pdata <- pdata[c(-23, -24),]
idatfiles <- idatfiles[c(-23, -24)]
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
batch = as.factor(pData(N.data)$Sentrix_ID)
mod = model.matrix(~1, data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
raw.data@
fsf
raw.data@channelData
raw.data@featureData
raw.data@featureData@varMetadata
raw.data@featureData@data
raw.data@experimentData
raw.data@annotation
raw.data@protocolData
raw.data@protocolData@data
raw.data@QC
raw.data@QC@data
raw.data@.__classVersion__
batch = as.factor(pData(N.data)$Sentrix_ID)
mod = model.matrix(~as.factor(Condition), data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_",
force = TRUE,
intgroup = c("Condition"))
library(arrayQualityMetrics)
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_",
force = TRUE,
intgroup = c("Condition"))
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_1",
force = TRUE,
do.logtransform = TRUE,
intgroup = c("Condition"))
arrayQualityMetrics(expressionset = raw.data,
outdir = "../plots/Report_raw",
force = TRUE,
do.logtransform = TRUE,
intgroup = c("Condition"))
warnings()
install.packages("hexbin")
arrayQualityMetrics(expressionset = raw.data,
outdir = "../plots/Report_raw",
force = TRUE,
do.logtransform = TRUE,
intgroup = c("Condition"))
max(exprs(N.data))
min(exprs(N.data))
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_",
force = TRUE,
do.logtransform = FALSE,
intgroup = c("Condition"))
source("pcaPlots.R")
studies <- read.table("../pdata/studies.tsv", header = TRUE, sep = "\t")
i=1
path = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE, stringsAsFactors = FALSE)
idatfiles = dir(path, pattern="idat", full.name=TRUE)
pdata <- pdata[c(-23, -24),]
idatfiles <- idatfiles[c(-23, -24)]
susp = which(pdata$Comment=="Suspicious")
pdata <- pdata[-susp,]
idatfiles <- idatfiles[-susp]
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
batch = as.factor(pData(N.data)$Sentrix_ID)
mod = model.matrix(~as.factor(Condition), data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_1",
force = TRUE,
do.logtransform = FALSE,
intgroup = c("Condition"))
i=1
path = paste("../raws/", studies[i,]$ID, sep="")
pdata = read.table(paste("../pdata/", studies[i,]$ID, "_pdata.tsv", sep=""), sep="\t", head=TRUE, stringsAsFactors = FALSE)
idatfiles = dir(path, pattern="idat", full.name=TRUE)
susp = which(pdata$Comment=="Suspicious")
pdata <- pdata[-susp,]
idatfiles <- idatfiles[-susp]
raw.data <- readIdatFiles(idatfiles)
raw.data@phenoData = AnnotatedDataFrame(pdata)
N.data <- normaliseIllumina(channel(raw.data, "Green"), method="neqc", transform="none")
batch = as.factor(pData(N.data)$Sentrix_ID)
mod = model.matrix(~as.factor(Condition), data=pData(N.data))
combat_edata = ComBat(dat=exprs(N.data), batch=batch, mod=mod, par.prior=TRUE, prior.plots=FALSE)
N.data@assayData$exprs <- combat_edata
pca = prcomp(t(exprs(N.data)))
pl <- pcaPlots(pca, pData(N.data), c("Condition", "Sentrix_ID"), studies[i,]$ID)
save_plot(paste("../plots/", studies[i,]$ID, "_PCA.pdf", sep=""),
base_height=4, base_aspect_ratio = 2.2, pl)
arrayQualityMetrics(expressionset = N.data,
outdir = "../plots/Report_1",
force = TRUE,
do.logtransform = FALSE,
intgroup = c("Condition"))
